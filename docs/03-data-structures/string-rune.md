# String & Rune

String Ğ² Go â€” ÑÑ‚Ğ¾ **immutable Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ±Ğ°Ğ¹Ñ‚Ğ¾Ğ²** (Ğ½Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²!). ĞŸĞ¾Ğ´ ĞºĞ°Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ UTF-8 encoded text, Ğ½Ğ¾ ÑĞ°Ğ¼Ğ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²ĞºĞµ.

## Memory Layout

```
Stack                          Heap / rodata
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ string header   â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚            â”‚ byte sequence       â”‚
â”‚ â”‚ ptr â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ [0xD0][0x9F][0xD1]..â”‚  UTF-8 bytes
â”‚ â”‚ len = 12    â”‚ â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      16 bytes
```

```go
// Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° (reflect.StringHeader, deprecated)
// Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ² runtime/string.go
type stringStruct struct {
    str unsafe.Pointer  // ÑƒĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ° Ğ±Ğ°Ğ¹Ñ‚Ñ‹
    len int             // Ğ´Ğ»Ğ¸Ğ½Ğ° Ğ² Ğ‘ĞĞ™Ğ¢ĞĞ¥
}
```

::: warning len Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ±Ğ°Ğ¹Ñ‚Ñ‹, Ğ½Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
```go
s := "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚"
len(s)           // 12 (Ğ±Ğ°Ğ¹Ñ‚), Ğ½Ğµ 6 (ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
len([]rune(s))   // 6 (Ñ€ÑƒĞ½/ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
```
:::

## UTF-8 Encoding

Go Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ UTF-8 â€” Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ° Ğ¾Ñ‚ 1 Ğ´Ğ¾ 4 Ğ±Ğ°Ğ¹Ñ‚ Ğ½Ğ° ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»:

| Ğ”Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½ Unicode | Ğ‘Ğ°Ğ¹Ñ‚ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ |
|------------------|------|--------|
| U+0000..U+007F | 1 | ASCII: `A` = `0x41` |
| U+0080..U+07FF | 2 | ĞšĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ğ°: `ĞŸ` = `0xD0 0x9F` |
| U+0800..U+FFFF | 3 | ĞšĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¹: `ä¸­` = `0xE4 0xB8 0xAD` |
| U+10000..U+10FFFF | 4 | Emoji: `ğŸ˜€` = `0xF0 0x9F 0x98 0x80` |

```go
s := "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚"
fmt.Printf("% x\n", []byte(s))
// d0 9f d1 80 d0 b8 d0 b2 d0 b5 d1 82

// ĞšĞ°Ğ¶Ğ´Ğ°Ñ ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ±ÑƒĞºĞ²Ğ° = 2 Ğ±Ğ°Ğ¹Ñ‚Ğ°
// ĞŸ = d0 9f, Ñ€ = d1 80, Ğ¸ = d0 b8, Ğ² = d0 b2, Ğµ = d0 b5, Ñ‚ = d1 82
```

## Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ: byte vs rune

```go
s := "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚"

// Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ‘ĞĞ™Ğ¢, Ğ½Ğµ Ñ€ÑƒĞ½Ñƒ
s[0]  // 0xD0 (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ±Ğ°Ğ¹Ñ‚ Ğ±ÑƒĞºĞ²Ñ‹ "ĞŸ")
s[1]  // 0x9F (Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ±Ğ°Ğ¹Ñ‚ Ğ±ÑƒĞºĞ²Ñ‹ "ĞŸ")

// Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ», Ğ½ÑƒĞ¶Ğ½Ğ° ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ
runes := []rune(s)
runes[0]  // 'ĞŸ' (1055 Ğ² Unicode)
```

## Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ: range Ğ´ĞµĞºĞ¾Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ UTF-8

```go
for i, c := range "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚" {
    fmt.Printf("i=%d c=%c\n", i, c)
}
// i=0  c=ĞŸ
// i=2  c=Ñ€    â† i ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ»Ğ¾ÑÑŒ Ğ½Ğ° 2 (Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ñ€ÑƒĞ½Ñ‹)
// i=4  c=Ğ¸
// i=6  c=Ğ²
// i=8  c=Ğµ
// i=10 c=Ñ‚
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚:** `i` â€” ÑÑ‚Ğ¾ **byte offset**, Ğ½Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°.

```
Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚" Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸:

Ğ‘Ğ°Ğ¹Ñ‚:   0  1  2  3  4  5  6  7  8  9  10 11
       [ĞŸ   ][Ñ€   ][Ğ¸   ][Ğ²   ][Ğµ   ][Ñ‚   ]
        â†‘     â†‘     â†‘     â†‘     â†‘     â†‘
i:      0     2     4     6     8     10
c:      ĞŸ     Ñ€     Ğ¸     Ğ²     Ğµ     Ñ‚
```

### Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶ĞµĞ½ Ğ¸Ğ½Ğ´ĞµĞºÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°

```go
// Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº
runeIdx := 0
for _, c := range "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚" {
    fmt.Printf("rune %d: %c\n", runeIdx, c)
    runeIdx++
}

// Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ² []rune
runes := []rune("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚")
for i, c := range runes {
    fmt.Printf("rune %d: %c\n", i, c)  // i â€” Ğ¸Ğ½Ğ´ĞµĞºÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°
}
```

::: tip ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² []rune
- ĞÑƒĞ¶ĞµĞ½ random access Ğ¿Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑÑƒ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°
- Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ `len()` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚Ğ° ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
- ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²

ĞĞ¾ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸: `[]rune` ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ **Ğ½Ğ¾Ğ²Ñ‹Ğ¹ slice** Ğ¸ **ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ**.
:::

## String Immutability

Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸ **Ğ½ĞµĞ¸Ğ·Ğ¼ĞµĞ½ÑĞµĞ¼Ñ‹**. Ğ›ÑĞ±Ğ°Ñ "Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ" ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ½Ğ¾Ğ²ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ:

```go
s := "hello"
s[0] = 'H'  // âŒ Ğ½Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ

// ĞÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ
s = "H" + s[1:]  // Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¸
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ immutable:**
1. **Thread-safe** â€” Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ³Ğ¾Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ°Ğ¼Ğ¸
2. **Hash stability** â€” ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğº ĞºĞ»ÑÑ‡Ğ¸ map
3. **Compiler optimizations** â€” string literals Ğ² read-only Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸

## String Concatenation

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: O(nÂ²) Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½ĞºĞ°Ñ‚ĞµĞ½Ğ°Ñ†Ğ¸Ğ¸

```go
// âŒ Avoid: Ğ½Ğ¾Ğ²Ğ°Ñ Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ½Ğ° ĞšĞĞ–Ğ”ĞĞ™ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
s := ""
for _, part := range parts {
    s += part  // O(n) ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ·
}
// Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: O(nÂ²) Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
```

```
Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 1: "" + "abc"     â†’ alloc "abc" (3 bytes)
Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 2: "abc" + "def"  â†’ alloc "abcdef" (6 bytes, ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ 3+3)
Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 3: "abcdef" + "ghi" â†’ alloc "abcdefghi" (9 bytes, ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ 6+3)
...
```

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: strings.Builder

```go
// âœ… O(n) â€” amortized append
var b strings.Builder
b.Grow(totalLen)  // Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ½Ğ¾ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ
for _, part := range parts {
    b.WriteString(part)
}
s := b.String()
```

### strings.Builder internals

```go
// strings/builder.go
type Builder struct {
    addr *Builder  // Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ° ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    buf  []byte    // Ñ€Ğ°ÑÑ‚ÑƒÑ‰Ğ¸Ğ¹ Ğ±ÑƒÑ„ĞµÑ€
}

func (b *Builder) WriteString(s string) (int, error) {
    b.buf = append(b.buf, s...)
    return len(s), nil
}

func (b *Builder) String() string {
    // unsafe ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ· ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ!
    return unsafe.String(unsafe.SliceData(b.buf), len(b.buf))
}
```

::: tip Zero-copy String()
`Builder.String()` **Ğ½Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ** â€” Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ string, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ° Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ Ğ±ÑƒÑ„ĞµÑ€. ĞŸĞ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ `String()` Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ñ‚ÑŒ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² Builder.
:::

### ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ°ĞºĞ¾Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´

| ĞœĞµÑ‚Ğ¾Ğ´ | ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ | ĞĞ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸ |
|-------|-------------------|-----------|
| `+` | 2-3 ÑÑ‚Ñ€Ğ¾ĞºĞ¸, Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹ Ğ½Ğ° compile time | 1 |
| `fmt.Sprintf` | Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼Ğ¸ | 1+ |
| `strings.Join` | Slice ÑÑ‚Ñ€Ğ¾Ğº Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ĞµĞ¼ | 1 |
| `strings.Builder` | Ğ¦Ğ¸ĞºĞ», Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº | 1 (Ñ Grow) |

```go
// ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ ĞºĞ¾Ğ½ĞºĞ°Ñ‚ĞµĞ½Ğ°Ñ†Ğ¸Ñ â€” OK
full := first + " " + last  // ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ‚Ğ¾Ñ€ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚

// Slice Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ĞµĞ¼
path := strings.Join(parts, "/")

// Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
msg := fmt.Sprintf("User %s (id=%d)", name, id)

// Ğ¦Ğ¸ĞºĞ» â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Builder
var b strings.Builder
for _, p := range parts {
    b.WriteString(p)
}
```

## Zero-copy ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸

### string â†’ []byte (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚)

```go
s := "hello"
b := []byte(s)  // Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ + ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ 5 Ğ±Ğ°Ğ¹Ñ‚
```

### ĞšĞ¾Ğ³Ğ´Ğ° ĞĞ• ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ (compiler optimization)

```go
// 1. Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ (Go 1.16+)
if string(byteSlice) == "expected" {
    // string ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ğ±ĞµĞ· Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸
}

// 2. Map lookup (Go 1.16+)
m := map[string]int{"key": 42}
_ = m[string(byteSlice)]  // Ğ±ĞµĞ· Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸

// 3. Range over []byte as string
for _, c := range string(byteSlice) {
    // Ğ±ĞµĞ· Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸
}
```

### unsafe ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ (Ğ¾ÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ¾!)

```go
import "unsafe"

// string â†’ []byte Ğ±ĞµĞ· ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
// âš ï¸ DANGER: Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚!
func unsafeBytes(s string) []byte {
    return unsafe.Slice(unsafe.StringData(s), len(s))
}

// []byte â†’ string Ğ±ĞµĞ· ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
// âš ï¸ DANGER: Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ slice!
func unsafeString(b []byte) string {
    return unsafe.String(unsafe.SliceData(b), len(b))
}
```

::: danger ĞšĞ¾Ğ³Ğ´Ğ° unsafe ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ÑÑ
```go
b := []byte("hello")
s := unsafeString(b)  // s ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ° b

b[0] = 'H'  // Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€ÑƒĞµĞ¼ b
fmt.Println(s)  // "Hello" â€” ÑÑ‚Ñ€Ğ¾ĞºĞ° "Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ"!

// Ğ­Ñ‚Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ immutability
// Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ»Ğ¾Ğ¼Ğ°Ñ‚ÑŒ map, compiler optimizations, etc.
```
:::

## ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²

```go
s := "Hello, ä¸–ç•Œ! ğŸ‰"

len(s)                    // 20 (Ğ±Ğ°Ğ¹Ñ‚)
len([]rune(s))            // 13 (Ñ€ÑƒĞ½) â€” Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ!
utf8.RuneCountInString(s) // 13 (Ñ€ÑƒĞ½) â€” Ğ±ĞµĞ· Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸ âœ…
```

```go
import "unicode/utf8"

// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚Ğ¸ UTF-8
utf8.ValidString(s)  // true ĞµÑĞ»Ğ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ UTF-8

// Ğ”ĞµĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ñ€ÑƒĞ½Ñ‹
r, size := utf8.DecodeRuneInString(s)
// r = 'H', size = 1

// Ğ”Ğ»Ñ ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ñ‹
r, size := utf8.DecodeRuneInString("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚")
// r = 'ĞŸ', size = 2
```

## String interning

**String interning** â€” Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸, Ğ¿Ñ€Ğ¸ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ¼ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğµ. Ğ’Ğ¼ĞµÑÑ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ², Ğ²ÑĞµ ÑÑÑ‹Ğ»ĞºĞ¸ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ½Ğ° Ğ¾Ğ´Ğ¸Ğ½ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ² ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿ÑƒĞ»Ğµ (intern pool).

```
Ğ‘ĞµĞ· interning:                    Ğ¡ interning:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ var a â”€â”€â”¼â”€â”€â–¶ "hello" (0x100)    â”‚ var a â”€â”€â”¼â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â–¼
â”‚ var b â”€â”€â”¼â”€â”€â–¶ "hello" (0x200)    â”‚ var b â”€â”€â”¼â”€â”€â–¶ "hello" (intern pool)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ var c â”€â”€â”¼â”€â”€â–¶ "hello" (0x300)    â”‚ var c â”€â”€â”¼â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   3 Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸                       1 Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ
```

Go **Ğ½Ğµ Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ interning** (Ğ² Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾Ñ‚ Java, Ğ³Ğ´Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ‹Ğµ Ğ»Ğ¸Ñ‚ĞµÑ€Ğ°Ğ»Ñ‹ Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ `String.intern()` Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ğ² Ğ¿ÑƒĞ»). ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ `string([]byte{...})` ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ½Ğ¾Ğ²ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ:

```go
a := string([]byte{'h', 'e', 'l', 'l', 'o'})
b := string([]byte{'h', 'e', 'l', 'l', 'o'})
// a Ğ¸ b â€” Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸, Ñ…Ğ¾Ñ‚Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ğ¾Ğµ
```

ĞĞ¾ string literals Ñ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¼ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼ **Ñ€Ğ°Ğ·Ğ´ĞµĞ»ÑÑÑ‚ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ**:

```go
a := "hello"
b := "hello"
// a Ğ¸ b ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¸ Ğ¸ Ñ‚Ğµ Ğ¶Ğµ Ğ±Ğ°Ğ¹Ñ‚Ñ‹ Ğ² rodata
```

## Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸

### Substring ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ alias

Substring Ğ² Go **Ğ½Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ** â€” Ğ¾Ğ½ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ `stringHeader`, ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ Ğ½Ğ° Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ backing array ÑĞ¾ ÑĞ¼ĞµÑ‰Ñ‘Ğ½Ğ½Ñ‹Ğ¼ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ĞµĞ¼:

```go
s := "very long string that takes lots of memory"
prefix := s[:4]  // "very"
```

```
Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° s:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ stringHeader     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      Backing array (44 bytes)
â”‚ â”‚ Data: 0x100 â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Len:  44     â”‚ â”‚      â”‚ v e r y   l o n g   s t r i n g   t h a ... â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â–²
                            â”‚
Substring prefix:           â”‚ (Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ Ğ°Ğ´Ñ€ĞµÑ!)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ stringHeader     â”‚        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚ â”‚ Data: 0x100 â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚ Len:  4      â”‚ â”‚   â† Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ğ¸Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ¿Ğ¾ĞºĞ° `prefix` Ğ¶Ğ¸Ğ², GC Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ²ĞµÑÑŒ 44-Ğ±Ğ°Ğ¹Ñ‚Ğ½Ñ‹Ğ¹ backing array â€” Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° `s` ÑƒĞ¶Ğµ Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ.

#### Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ ÑƒÑ‚ĞµÑ‡ĞºĞ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸

```go
// âŒ Memory leak: Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹, Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ¼ĞµĞ½Ğ°
var fileNames []string

for _, path := range hugeDirListing {
    // ĞšĞ°Ğ¶Ğ´Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° path Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ 200+ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²:
    // "/very/long/path/to/some/deeply/nested/directory/file.txt"

    content, _ := os.ReadFile(path)
    line := string(content)  // ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 10KB Ğ½Ğ° Ñ„Ğ°Ğ¹Ğ»

    // Ğ‘ĞµÑ€Ñ‘Ğ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ 50 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² ĞºĞ°Ğº "Ğ¿Ñ€ĞµĞ²ÑŒÑ"
    preview := line[:50]
    fileNames = append(fileNames, preview)

    // preview Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ° Ğ’Ğ¡Ğ• 10KB ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°!
}
// ĞŸÑ€Ğ¸ 1000 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼ ~50KB, Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ ~10MB Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
```

```
ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ:                          Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fileNames[0] â”€â”€â”€â”¼â”€â–¶ 50 bytes     â”‚ fileNames[0] â”€â”€â”€â”¼â”€â–¶ 10KB (Ğ²ĞµÑÑŒ Ñ„Ğ°Ğ¹Ğ»!)
â”‚ fileNames[1] â”€â”€â”€â”¼â”€â–¶ 50 bytes     â”‚ fileNames[1] â”€â”€â”€â”¼â”€â–¶ 10KB
â”‚ fileNames[2] â”€â”€â”€â”¼â”€â–¶ 50 bytes     â”‚ fileNames[2] â”€â”€â”€â”¼â”€â–¶ 10KB
â”‚ ...             â”‚                â”‚ ...             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ~50KB total                        ~10MB total
```

#### Ğ ĞµÑˆĞµĞ½Ğ¸Ñ

**1. `strings.Clone` (Go 1.20+) â€” Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ±:**

```go
preview := strings.Clone(line[:50])
```

```
ĞŸĞ¾ÑĞ»Ğµ Clone:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ preview          â”‚      ĞĞ¾Ğ²Ñ‹Ğ¹ backing array (50 bytes)
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Data: 0x500 â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â–¶â”‚ v e r y   l o n g   s t r i n g   t h a t   t ...â”‚
â”‚ â”‚ Len:  50     â”‚ â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ 10KB Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ñ‹ GC âœ“
```

**2. ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· `[]byte` (Ğ´Ğ¾ Go 1.20):**

```go
preview := string([]byte(line[:50]))
```

**3. `strings.Builder` Ğ´Ğ»Ñ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹:**

```go
var b strings.Builder
b.WriteString(line[:50])
preview := b.String()  // Ğ½Ğ¾Ğ²Ğ°Ñ Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ
```

::: tip ĞšĞ¾Ğ³Ğ´Ğ° alias â€” ÑÑ‚Ğ¾ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾
ĞĞµ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ½ÑƒĞ¶Ğ½Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ. Ğ•ÑĞ»Ğ¸ substring ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğ¶Ğ¸Ğ²ÑƒÑ‰Ğ¸Ğ¹ Ğ¸Ğ»Ğ¸ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ» Ñ‚Ğ¾Ğ¶Ğµ Ğ½ÑƒĞ¶ĞµĞ½ â€” alias ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‚ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ Ğ¸ CPU:

```go
func hasPrefix(s, prefix string) bool {
    if len(s) < len(prefix) {
        return false
    }
    return s[:len(prefix)] == prefix  // alias OK â€” Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹
}
```
:::

::: warning ĞšĞ°Ğº Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ
```go
// ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ€Ğ°Ğ·Ğ´ĞµĞ»ÑÑÑ‚ Ğ»Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ
func sharesBackingArray(a, b string) bool {
    if len(a) == 0 || len(b) == 0 {
        return false
    }
    aStart := uintptr(unsafe.Pointer(unsafe.StringData(a)))
    aEnd := aStart + uintptr(len(a))
    bStart := uintptr(unsafe.Pointer(unsafe.StringData(b)))
    bEnd := bStart + uintptr(len(b))

    return aStart < bEnd && bStart < aEnd  // Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ñ‹ Ğ¿ĞµÑ€ĞµÑĞµĞºĞ°ÑÑ‚ÑÑ
}
```

**Ğ’ pprof:** Ğ¸Ñ‰Ğ¸ Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸ ÑÑ‚Ñ€Ğ¾Ğº, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ¾Ğ¼Ñƒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñƒ.
:::

### Invalid UTF-8

```go
// ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ UTF-8
bad := string([]byte{0xff, 0xfe})

for _, r := range bad {
    fmt.Printf("%U ", r)  // U+FFFD U+FFFD (replacement character)
}
```

Go Ğ·Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğ° `\uFFFD` (replacement character).

## Ğ¤Ğ°Ğ¹Ğ»Ñ‹ runtime/

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|------------|
| `runtime/string.go` | String operations, concatenation |
| `runtime/utf8.go` | UTF-8 encoding/decoding |
| `strings/builder.go` | strings.Builder implementation |
| `unicode/utf8/utf8.go` | Public UTF-8 API |

## Debugging

```bash
# ĞĞ°Ğ¹Ñ‚Ğ¸ string Ğ°Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸
go build -gcflags="-m" 2>&1 | grep "string"

# Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº ĞºĞ¾Ğ½ĞºĞ°Ñ‚ĞµĞ½Ğ°Ñ†Ğ¸Ğ¸
go test -bench=. -benchmem ./...
```

```go
// ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ sharing backing storage
import "reflect"

func sharesMemory(a, b string) bool {
    ha := (*reflect.StringHeader)(unsafe.Pointer(&a))
    hb := (*reflect.StringHeader)(unsafe.Pointer(&b))
    return ha.Data == hb.Data
}
```

## Ğ”Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞµĞµ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ

- [Strings, bytes, runes and characters in Go](https://go.dev/blog/strings) â€” Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğ³
- [UTF-8 and Unicode FAQ](https://www.cl.cam.ac.uk/~mgk25/unicode.html) â€” Ğ¸ÑÑ‡ĞµÑ€Ğ¿Ñ‹Ğ²Ğ°ÑÑ‰ĞµĞµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾
- Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ¸ĞºĞ¸: `$GOROOT/src/runtime/string.go`, `unicode/utf8/utf8.go`
